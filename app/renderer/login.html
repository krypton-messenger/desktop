<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="loginForm.css">
    <title>Krypton Beta</title>
</head>

<body>
    <main>
        <div class="login">

            <form action="javascript:submit();">
                <h1>Log in</h1>
                <input name="serverurl" id="serverurl" placeholder="server" type="text">
                <input name="username" id="username" placeholder="username" type="text">
                <input name="password" id="password" placeholder="password" type="password">
                <input type="submit" value="Log in" role="button" aria-label="Submit" id="submit">
                <p id="error"></p>
                or
                <a href="javascript:createAccount()" tabindex="0">
                    create account
                </a>
            </form>

        </div>
    </main>
    <script>
        if (window.config.server) {
            document.getElementById("serverurl").value = window.config.server;
            document.getElementById("username").focus();
        } else {
            document.getElementById("serverurl").focus();
        }

        function submit() {
            document.getElementById("submit").classList.add("loading");
            document.getElementById("submit").setAttribute("disabled", "true");
            window.ipc.send('login', {
                serverurl: document.getElementById("serverurl").value,
                username: document.getElementById("username").value,
                password: document.getElementById("password").value
            });
        }

        function createAccount() {
            window.ipc.send('toggleLoginView', {
                newView: "signup"
            });
        }

        window.ipc.listen((response, content) => {
            switch (content.trigger) {
                case "login":
                    // remove all classes
                    document.getElementById("submit").className = "";
                    document.getElementById("error").innerHTML = "";

                    if (content.success) {
                        document.getElementById("submit").classList.add("success");
                    } else {
                        document.getElementById("submit").removeAttribute("disabled");
                        document.getElementById("submit").classList.add("error");
                        document.getElementById("error").appendChild(document.createTextNode(content.error.description ?? "An unknown error occured"));
                    }
                    break;
                default:
                    console.log(["unknown trigger", content]);
                    break;
            }
        });

    </script>
</body>

</html>
